<p align="left"><h1>Sample app deployment with lets encrypts</h1><br><br><h2>Ensure Workload Identity is Enabled on GKE</h2><br><br><b>Verify if Workload Identity is enabled for your cluster:</b><br><br>gcloud container clusters describe <your-cluster-name> --region <your-region> \<br>  --format="value(workloadIdentityConfig.workloadPool)"<br><br>Create a GCP Service Account<br><br>gcloud iam service-accounts create SERVICE_ACCOUNT_NAME \<br>  --description="DESCRIPTION" \<br>  --display-name="DISPLAY_NAME"<br><br>Assign Role to the Created dns-solver Service Account:<br><br>gcloud projects add-iam-policy-binding staging \<br>  --member="serviceAccount:dns-solver@staging.iam.gserviceaccount.com" \<br>  --role="roles/dns.admin"<br><br>Add IAM Policy Binding:<br><br>gcloud iam service-accounts add-iam-policy-binding dns-solver@staging.iam.gserviceaccount.com \<br>  --role roles/iam.workloadIdentityUser \<br>  --member "serviceAccount:staging.svc.id.goog[cert-manager/cert-manager]"<br><br><h2>Prerequisites</h2><br><br>Ensure you have the following tools installed:<br><br>kubectl (v1.14+)<br><br>Kustomize (bundled with kubectl)<br><br>Directory Structure<br><br>Your project directory should be structured as follows:<br>/kustomize<br>│── base<br>│   ├── deployment.yaml<br>│   ├── service.yaml<br>│   ├── kustomization.yaml<br>│── overlays<br>│   ├── staging<br>│   │   ├── kustomization.yaml<br>│   │   ├── p-prod-cert.yaml<br>│   ├── prod<br>│       ├── kustomization.yaml<br>│       ├── p-prod-cert.yaml<br><br><h2>Deployment</h2><br><br>Clone the Repository<br><br>git clone https://github.com/Abhimanyushahi/kustomize.git<br>cd kustomize<br><br>Create Namespace<br><br>kubectl create ns staging<br><br>kubectl create ns cert-manger<br><br>Install cert-manager in the cluster<br><br><tab><tab>kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.17.0/cert-manager.yaml<br><br>Rendering Manifests<br><br>Generate Kubernetes manifests using Kustomize:<br><br>kustomize build overlays/staging/<br><br>Applying Manifests to a Cluster<br><br>Apply the generated manifests to your Kubernetes cluster:<br><br>kustomize build overlays/staging/ | kubectl apply -f -<br><br>Annotate the GCP Service Account with Kubernetes Service Account<br><br>kubectl annotate sa cert-manager -n cert-manager \<br>  iam.gke.io/gcp-service-account=dns-solver@staging.iam.gserviceaccount.com<br><br><h2>Verifying Deployment</h2><br><br>Check applied resources:<br><br>kubectl get all -n staging<br>kubectl get certificate -n staging<br>kubectl describe certificate prod-cert -n staging<br><br>If the certificate is not ready, check its status:<br><br>kubectl get clusterissuer -n staging<br>kubectl get clusterissuer prod-ca-issuer -n staging<br>kubectl describe clusterissuer prod-ca-issuer -n staging<br><br>Check certificate requests:<br><br>kubectl get certificaterequest -n staging<br>kubectl describe certificaterequest prod-cert-1 -n staging<br><br>Inspect cert-manager logs:<br><br>kubectl logs -n cert-manager -l app=cert-manager<br><br><h2>Troubleshooting</h2><br><br>Check logs for errors:<br><br>kubectl logs -n cert-manager -l app=cert-manager<br><br>Restart cert-manager:<br><br>kubectl delete pod -n cert-manager --all<br><br>Check CertificateRequest status:<br><br>kubectl get certificaterequest -n staging<br>kubectl describe certificaterequest prod-cert-1 -n staging<br><br>Check ClusterIssuer status:<br><br>kubectl get clusterissuer prod-ca-issuer -n staging<br>kubectl describe clusterissuer prod-ca-issuer -n staging<br><br>Check DNS Challenges<br><br>kubectl get challenge -n staging<br>kubectl describe challenge <challenge-name> -n staging<br><br>Ensure your IAM service account has the necessary permissions (dns.admin or dns.editor). Verify TXT records in CloudDNS:<br><br>gcloud dns record-sets list --zone=tecsolution<br>nslookup -q=TXT _acme-challenge.tecsolution.solutions<br><br>Restart Cert-Manager to Apply Changes<br><br>kubectl delete pod -n cert-manager --all<br>kubectl delete certificate prod-cert -n staging<br>kustomize build overlays/staging/ | kubectl apply -f -<br><br><h2>Conclusion</h2><br><br>This guide helps you manage Kubernetes configurations efficiently using Kustomize. Modify your overlays as needed to adapt to different environments</p>

###